# 트랜잭션과 잠금

## 트랜잭션

* 작업의 완전성, 즉 데이터의 정합성을 보장해 주는 기능.
* 작업의 일부만 적용되는 현상이 발생하지 않게 만들어주는 기능이다. all or nothing
* 프로그램 코드에서 트랜잭션의 범위를 최소화하는 것이 좋다.
  * 네트워크 작업이 있는 경우 반드시 트랜잭션에서 배제해야 한다.

## 잠금

* 동시성을 제어하기 위한 기능.
* 잠금이 없다면 하나의 데이터를 여러 커넥션에서 동시에 변경할 수 있게 되어 레코드의 값을 예측할 수 없게 된다.
  * 여러 커넥션의 요청을 순서대로 진행할 수 있게 해준다.
* MySQL에서 사용되는 잠금은 스토리지 엔진 레벨과 MySQL 엔진 레벨로 나눌 수 있다.
  * MySQL 엔진 레벨의 잠금은 모든 스토리지 엔진 레벨에 영향을 미친다.
  * 그 역은 영향을 미치지 않는다.

### MySQL 엔진의 잠금

#### 글로벌 락

* 락 획득 명령 `FLUSH TABLES WITH READ LOCK`&#x20;
* MySQL 서버의 모든 변경 작업을 멈추는 락으로 제공되는 잠금 중 가장 범위가 크다.
* InnoDB 스토리지 엔진은 트랜잭션을 지원하기 때문에 일관된 데이터 상태를 위해 모든 변경 작업을 멈출 필요가 없다.
* 온라인 작업에 상당한 영향을 미치기에 애플리케이션에서 사용할 일은 거의 없다.

#### 테이블 락

* 락 획득 명령 `LOCK TABLES table_name [READ|WRITE]`
  * 명시적 획득 반납 명령 `UNLOCK TABLES`
* 온라인 작업에 상당한 영향을 미치기에 애플리케이션에서 사용할 일은 거의 없다.

#### 묵시적 락

* InnoDB는 스토리지 엔진에서 레코드 기반의 잠금을 제공한다.
* 그래서 대부분의 DML 쿼리에서는 무시되고, DDL 쿼리에만 영향을 미친다.

#### 네임드 락

* 락 획득 명령 `GET_LOCK() 함수`
* 임의의 문자열에 대해 잠금을 설정할 수 있다.

#### 메타데이터 락

* 테이블이나 뷰 같은 데이터베이스 객체의 이름이나 구조를 변경하는 경우 획득하는 잠금.
  * 명시적인 획득/해제가 아닌 자동으로 획득되는 잠금.

### InnoDB 스토리지 엔진 잠금

* 8.0 부터 기본 스토리지 엔진으로 채택되었으며 트랜잭션을 지원한다.
* MySQL에서 제공하는 잠금과는 별개로 스토리지 엔진 내부에서 레코드 기반 잠금을 한다.
  * MyISAM보다 뛰어난 동시성 처리 제공.

#### 레코드 락

#### 갭 락

#### 넥스트 키 락

#### 자동 증가&#x20;

## 격리 수준

* 하나의 트랜잭션, 또는 복수 개의 트랜잭션 간의 작업 내용을 어떻게 공유하고 차단할지 결정하는 레벨.

####
